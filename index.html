<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>3.1ì ˆ ì—¬ë³µ ë°°ë“œë¯¼í„´ ëª¨ì„ ì‹ ì²­</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700;900&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg: #0a0e14;
      --card: #101822;
      --border: #1e3347;
      --text: #f1f5f9;
      --muted: #94a3b8;
      --accent: #e11d48;
      --ok: #22c55e;
      --wait: #f59e0b;
      --bad: #ef4444;
    }
    * { box-sizing: border-box; margin:0; padding:0; }
    body {
      font-family: 'Noto Sans KR', system-ui, sans-serif;
      background: linear-gradient(135deg, #0f172a 0%, var(--bg) 100%);
      color: var(--text);
      min-height: 100vh;
      padding: 24px 16px;
      line-height: 1.5;
    }
    .wrap { max-width: 1100px; margin: 0 auto; }
    header { text-align: center; margin-bottom: 32px; }
    .hero {
      position: relative;
      height: 240px;
      border-radius: 20px;
      overflow: hidden;
      margin-bottom: 24px;
      box-shadow: 0 20px 40px rgba(0,0,0,0.6);
    }
    .hero img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      filter: brightness(0.75) contrast(1.1);
    }
    .hero-overlay {
      position: absolute;
      inset: 0;
      background: linear-gradient(to bottom, rgba(10,14,20,0.1), rgba(10,14,20,0.85) 70%);
      display: flex;
      flex-direction: column;
      justify-content: flex-end;
      padding: 32px 28px;
    }
    .hero h1 {
      font-size: clamp(28px, 6vw, 42px);
      font-weight: 900;
      letter-spacing: -1.2px;
      margin-bottom: 8px;
      text-shadow: 0 3px 12px rgba(0,0,0,0.7);
    }
    .hero .sub {
      font-size: 17px;
      color: #e2e8f0;
      opacity: 0.95;
      font-weight: 500;
    }
    .grid { display: grid; gap: 24px; }
    @media (min-width: 960px) { .grid { grid-template-columns: 420px 1fr; } }

    .card {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 20px;
      padding: 28px;
      box-shadow: 0 12px 32px rgba(0,0,0,0.4);
      backdrop-filter: blur(8px);
      transition: transform 0.18s ease, box-shadow 0.18s ease;
    }
    .card:hover { transform: translateY(-4px); box-shadow: 0 20px 48px rgba(0,0,0,0.5); }

    .section-title { font-size: 20px; font-weight: 800; margin-bottom: 4px; }
    .section-desc { color: var(--muted); font-size: 14px; margin-bottom: 20px; }

    form { display: grid; gap: 16px; }
    label { font-size: 13px; font-weight: 600; color: var(--muted); margin-bottom: 6px; display:block; }
    input, select {
      width: 100%;
      padding: 14px 16px;
      border-radius: 12px;
      border: 1px solid var(--border);
      background: rgba(15,23,42,0.6);
      color: var(--text);
      font-size: 15px;
      transition: border-color 0.15s;
    }
    input:focus, select:focus {
      outline: none;
      border-color: var(--accent);
      box-shadow: 0 0 0 3px rgba(225,29,72,0.15);
    }
    .two-cols { display:grid; grid-template-columns: 1fr; gap:16px; }
    @media (min-width: 500px) { .two-cols { grid-template-columns: 1fr 1fr; } }

    .btn {
      appearance: none;
      border: none;
      padding: 14px 24px;
      border-radius: 14px;
      font-size: 15px;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.15s ease;
    }
    .btn-primary {
      background: linear-gradient(135deg, var(--accent) 0%, #c026d3 100%);
      color: white;
      box-shadow: 0 6px 20px rgba(225,29,72,0.3);
    }
    .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 10px 28px rgba(225,29,72,0.45); }
    .btn-primary:active { transform: translateY(0); }
    .btn-secondary {
      background: rgba(59,130,246,0.15);
      border: 1px solid rgba(59,130,246,0.4);
      color: #93c5fd;
    }
    .btn-secondary:hover { background: rgba(59,130,246,0.25); }

    .pill {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 8px 14px;
      border-radius: 999px;
      font-size: 13px;
      font-weight: 600;
    }
    .pill-sync-ok  { background: rgba(34,197,94,0.15); color: #86efac; border:1px solid rgba(34,197,94,0.4); }
    .pill-sync-err { background: rgba(239,68,68,0.15); color: #fca5a5; border:1px solid rgba(239,68,68,0.4); }

    table { width:100%; border-collapse: collapse; font-size:14px; margin-top: 16px; }
    th {
      text-align:left;
      padding: 12px 14px;
      color: #cbd5e1;
      font-weight: 600;
      font-size: 13px;
      border-bottom: 1px solid var(--border);
      background: rgba(15,23,42,0.4);
    }
    td { padding: 14px 14px; border-bottom: 1px solid var(--border); }
    tr:nth-child(even) { background: rgba(15,23,42,0.2); }
    tr:hover { background: rgba(30,58,138,0.18); }

    .status { display:inline-flex; align-items:center; gap:8px; font-weight:700; font-size:13px; }
    .dot { width: 10px; height:10px; border-radius:50%; }
    .s-ok .dot { background: var(--ok); }     .s-ok { color: #86efac; }
    .s-wait .dot { background: var(--wait); } .s-wait { color: #fde047; }
    .s-bad .dot { background: var(--bad); }   .s-bad { color: #fca5a5; }

    .toast {
      position: fixed;
      bottom: 24px;
      left: 50%;
      transform: translateX(-50%) translateY(8px);
      padding: 14px 24px;
      border-radius: 14px;
      background: rgba(15,23,42,0.95);
      border: 1px solid var(--border);
      color: var(--text);
      font-weight: 500;
      z-index: 100;
      opacity: 0;
      transition: opacity 0.25s ease, transform 0.25s ease;
      pointer-events: none;
      max-width: min(560px, calc(100vw - 24px));
      text-align: center;
    }
    .toast.show { opacity: 1; transform: translateX(-50%) translateY(0); }

    .hint { font-size: 13px; color: var(--muted); margin-top: 12px; line-height: 1.6; }
    .meta-row { display:flex; justify-content:center; gap:10px; align-items:center; flex-wrap:wrap; margin-bottom: 32px; }
  </style>
</head>

<body>
  <div class="wrap">
    <header>
      <div class="hero">
        <img src="https://thumbs.dreamstime.com/b/empty-badminton-court-spotlight-lit-modern-sports-arena-glows-under-bright-spotlights-indoor-ready-match-408686914.jpg" alt="ë°°ë“œë¯¼í„´ ì½”íŠ¸" />
        <div class="hero-overlay">
          <h1>3.1ì ˆ ì—¬ë³µ ë°°ë“œë¯¼í„´ ëª¨ì„</h1>
          <div class="sub">í•¨ê»˜ ë›°ë©° ìƒˆ ì—­ì‚¬ë¥¼ ë§Œë“¤ì–´ìš” ğŸ¸ğŸ‡°ğŸ‡·</div>
        </div>
      </div>

      <div class="meta-row">
        <span class="pill pill-sync-ok" id="syncPill">â³ ë™ê¸°í™” ì¤€ë¹„ ì¤‘â€¦</span>
        <button class="btn btn-secondary" id="refreshBtn" type="button">ìƒˆë¡œê³ ì¹¨</button>
      </div>
    </header>

    <div class="grid">
      <!-- ì‹ ì²­ í¼ -->
      <section class="card">
        <div class="section-title">ì°¸ê°€ ì‹ ì²­</div>
        <div class="section-desc">ì…ë ¥ ì¦‰ì‹œ â€œëŒ€ê¸° ì¤‘â€ìœ¼ë¡œ ë“±ë¡ë©ë‹ˆë‹¤</div>

        <form id="applyForm">
          <div>
            <label for="name">ì´ë¦„</label>
            <input id="name" name="name" placeholder="ì˜ˆ: ê¹€ì‚¼ì¼" required maxlength="30" />
          </div>

          <div class="two-cols">
            <div>
              <label for="level">ê¸‰ìˆ˜</label>
              <select id="level" name="level" required>
                <option value="" disabled selected>ì„ íƒí•˜ì„¸ìš”</option>
                <option>ì´ˆì‹¬</option>
                <option>D</option>
                <option>C</option>
                <option>B</option>
                <option>A</option>
                <option>ìƒê´€ì—†ìŒ</option>
              </select>
            </div>
            <div>
              <label for="gender">ì„±ë³„</label>
              <select id="gender" name="gender" required>
                <option value="" disabled selected>ì„ íƒí•˜ì„¸ìš”</option>
                <option>ì—¬</option>
                <option>ë‚¨</option>
                <option>ê¸°íƒ€</option>
                <option>ë¹„ê³µê°œ</option>
              </select>
            </div>
          </div>

          <button class="btn btn-primary" type="submit" id="submitBtn">ì‹ ì²­í•˜ê¸°</button>
        </form>

        <div class="hint">
          â€» êµ¬ê¸€ ì‹œíŠ¸ì—ì„œ ìƒíƒœë¥¼ â€œì°¸ê°€â€ / â€œë¶ˆì°¸â€ / â€œì·¨ì†Œâ€ë¡œ ë³€ê²½í•˜ë©´ ì‹¤ì‹œê°„ ë°˜ì˜ë©ë‹ˆë‹¤.<br>
          ë¬¸ì˜ëŠ” ì¹´í†¡ ì˜¤í”ˆì±„íŒ… ë˜ëŠ” ìš´ì˜ì§„ì—ê²Œ ì—°ë½ ì£¼ì„¸ìš”!
        </div>
        <div class="toast" id="toast"></div>
      </section>

      <!-- ëª…ë‹¨ -->
      <section class="card">
        <div style="display:flex; justify-content:space-between; align-items:center; flex-wrap:wrap; gap:12px; margin-bottom:20px;">
          <div>
            <div class="section-title">ì°¸ê°€ ëª…ë‹¨</div>
            <div id="countText" style="color:var(--muted); font-size:14px;">0ëª…</div>
          </div>
          <div>
            <span class="pill" id="autoPill">ğŸ”„ ìë™ ê°±ì‹ : 10ì´ˆ</span>
          </div>
        </div>

        <div style="display:flex; gap:12px; flex-wrap:wrap; margin-bottom:16px;">
          <input id="search" placeholder="ì´ë¦„ Â· ê¸‰ìˆ˜ ê²€ìƒ‰" style="flex:1; min-width:180px;" />
          <select id="filterStatus">
            <option value="all" selected>ì „ì²´ ìƒíƒœ</option>
            <option value="ëŒ€ê¸°">ëŒ€ê¸°ë§Œ</option>
            <option value="ì°¸ê°€">ì°¸ê°€ë§Œ</option>
          </select>
          <select id="sortBy">
            <option value="time_desc" selected>ìµœì‹  ì‹ ì²­ìˆœ</option>
            <option value="time_asc">ì˜¤ë˜ëœìˆœ</option>
            <option value="name_asc">ì´ë¦„ìˆœ</option>
          </select>
        </div>

        <table>
          <thead>
            <tr>
              <th style="width:120px;">ìƒíƒœ</th>
              <th>ì´ë¦„</th>
              <th style="width:90px;">ê¸‰ìˆ˜</th>
            </tr>
          </thead>
          <tbody id="tbody">
            <tr><td colspan="3" style="text-align:center; padding:32px; color:var(--muted);">ëª…ë‹¨ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘â€¦</td></tr>
          </tbody>
        </table>
      </section>
    </div>
  </div>

  <script>
    // â”€â”€ CONFIG (âš ï¸ ì—¬ê¸°ë§Œ ë„ˆ URLë¡œ ë°”ê¾¸ë©´ ë¨) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    const CONFIG = {
      // Apps Script WebApp URL (/exec)
      API_BASE: "https://script.google.com/macros/s/AKfycbx8LyhaIxWhXxEZ6IsIRbKJhjYS3kgZOXIaKV8AY7VmAASGs9LsI4KXZ1o0u0KIC8FEQg/exec",
      POLL_MS: 10_000,
    };

    // â”€â”€ helpers â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    const $ = (id) => document.getElementById(id);

    function escapeHtml(str) {
      return String(str ?? "")
        .replaceAll("&", "&amp;")
        .replaceAll("<", "&lt;")
        .replaceAll(">", "&gt;")
        .replaceAll('"', "&quot;")
        .replaceAll("'", "&#039;");
    }

    function toast(msg, kind = "info") {
      const el = $("toast");
      el.textContent = msg;
      el.classList.add("show");
      if (kind === "ok") el.style.borderColor = "rgba(34,197,94,0.45)";
      else if (kind === "bad") el.style.borderColor = "rgba(239,68,68,0.45)";
      else el.style.borderColor = "rgba(30,51,71,0.9)";
      clearTimeout(toast._t);
      toast._t = setTimeout(() => el.classList.remove("show"), 3200);
    }

    function setPill(text, ok = true) {
      const pill = $("syncPill");
      pill.textContent = text;
      pill.className = "pill " + (ok ? "pill-sync-ok" : "pill-sync-err");
    }

    function statusChip(statusRaw) {
      const status = (statusRaw || "ëŒ€ê¸°").trim();
      if (status === "ì°¸ê°€") return `<span class="status s-ok"><span class="dot"></span>ì°¸ê°€</span>`;
      if (status === "ë¶ˆì°¸" || status === "ì·¨ì†Œ") return `<span class="status s-bad"><span class="dot"></span>${escapeHtml(status)}</span>`;
      return `<span class="status s-wait"><span class="dot"></span>ëŒ€ê¸°</span>`;
    }

    // â”€â”€ JSONP (GitHub Pagesìš© í•µì‹¬) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function jsonp(url) {
      return new Promise((resolve, reject) => {
        const cb = "cb_" + Math.random().toString(36).slice(2);
        const s = document.createElement("script");
        const u = new URL(url);

        u.searchParams.set("callback", cb);

        window[cb] = (data) => {
          cleanup();
          resolve(data);
        };

        function cleanup() {
          try { delete window[cb]; } catch {}
          s.remove();
        }

        s.onerror = () => {
          cleanup();
          reject(new Error("JSONP load failed"));
        };

        s.src = u.toString();
        document.body.appendChild(s);
      });
    }

    // â”€â”€ API (JSONPë¡œ list/apply) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    async function apiGetList() {
      const url = new URL(CONFIG.API_BASE);
      url.searchParams.set("action", "list");
      url.searchParams.set("_t", String(Date.now())); // cache bust
      const data = await jsonp(url.toString());
      if (!data || !Array.isArray(data.items)) throw new Error("ì‘ë‹µ í˜•ì‹ ì˜¤ë¥˜ (items ë°°ì—´ ì—†ìŒ)");
      return data.items;
    }

    async function apiApply(payload) {
      const url = new URL(CONFIG.API_BASE);
      url.searchParams.set("action", "apply");
      url.searchParams.set("name", payload.name);
      url.searchParams.set("level", payload.level);
      url.searchParams.set("gender", payload.gender);
      url.searchParams.set("_t", String(Date.now()));
      const data = await jsonp(url.toString());
      if (!data || data.ok !== true) throw new Error(data?.error || "ì‹ ì²­ ì‹¤íŒ¨");
      return data;
    }

    // â”€â”€ state + render â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    let allItems = [];

    function applyFiltersAndRender() {
      const q = $("search").value.trim().toLowerCase();
      const f = $("filterStatus").value;
      const sortBy = $("sortBy").value;

      let items = [...allItems];

      if (q) {
        items = items.filter((it) => {
          const s = `${it.name ?? ""} ${it.level ?? ""}`.toLowerCase();
          return s.includes(q);
        });
      }

      if (f !== "all") items = items.filter((it) => (it.status ?? "ëŒ€ê¸°").trim() === f);

      const t = (x) => {
        const ms = new Date(x?.createdAt ?? "").getTime();
        return Number.isFinite(ms) ? ms : 0;
      };
      if (sortBy === "time_desc") items.sort((a, b) => t(b) - t(a));
      if (sortBy === "time_asc")  items.sort((a, b) => t(a) - t(b));
      if (sortBy === "name_asc")  items.sort((a, b) => String(a.name ?? "").localeCompare(String(b.name ?? ""), "ko"));

      $("countText").textContent = `${items.length}ëª…`;

      const tbody = $("tbody");
      if (items.length === 0) {
        tbody.innerHTML = `<tr><td colspan="3" style="text-align:center; padding:32px; color:var(--muted);">í‘œì‹œí•  í•­ëª©ì´ ì—†ìŠµë‹ˆë‹¤.</td></tr>`;
        return;
      }

      tbody.innerHTML = items.map((it) => `
        <tr>
          <td>${statusChip(it.status)}</td>
          <td style="font-weight:700;">${escapeHtml(it.name ?? "")}</td>
          <td>${escapeHtml(it.level ?? "")}</td>
        </tr>
      `).join("");
    }

    // â”€â”€ polling â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    let pollTimer = null;
    function startPolling() {
      if (pollTimer) clearInterval(pollTimer);
      pollTimer = setInterval(() => refreshList(false), CONFIG.POLL_MS);
    }

    // â”€â”€ main actions â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    async function refreshList(showToast = true) {
      try {
        setPill("ğŸ”„ ë™ê¸°í™” ì¤‘â€¦", true);
        const items = await apiGetList();
        allItems = items;
        applyFiltersAndRender();
        setPill("âœ… ë™ê¸°í™” ì™„ë£Œ", true);
        if (showToast) toast("ëª…ë‹¨ì„ ìƒˆë¡œ ë¶ˆëŸ¬ì™”ì–´ìš”.", "ok");
      } catch (e) {
        setPill("âš ï¸ ë™ê¸°í™” ì‹¤íŒ¨", false);
        if (showToast) toast(e.message || "ë¶ˆëŸ¬ì˜¤ê¸° ì˜¤ë¥˜", "bad");
        $("tbody").innerHTML = `
          <tr>
            <td colspan="3" style="text-align:center; padding:32px; color:var(--muted);">
              ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨: ${escapeHtml(e.message || "ì˜¤ë¥˜")}
            </td>
          </tr>
        `;
      }
    }

    async function onSubmit(e) {
      e.preventDefault();
      const name = $("name").value.trim();
      const level = $("level").value;
      const gender = $("gender").value;

      if (!name || !level || !gender) {
        toast("ì´ë¦„/ê¸‰ìˆ˜/ì„±ë³„ì„ ëª¨ë‘ ì…ë ¥í•´ì¤˜!", "bad");
        return;
      }

      $("submitBtn").disabled = true;
      $("submitBtn").textContent = "ì‹ ì²­ ì¤‘â€¦";

      try {
        await apiApply({ name, level, gender });
        toast("ì‹ ì²­ ì™„ë£Œ! ëª…ë‹¨ì— â€˜ëŒ€ê¸°â€™ë¡œ ë“±ë¡ëì–´ìš”.", "ok");
        $("applyForm").reset();
        await refreshList(false);
      } catch (err) {
        toast(err.message || "ì‹ ì²­ ì˜¤ë¥˜", "bad");
      } finally {
        $("submitBtn").disabled = false;
        $("submitBtn").textContent = "ì‹ ì²­í•˜ê¸°";
      }
    }

    // â”€â”€ wire events â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    $("applyForm").addEventListener("submit", onSubmit);
    $("refreshBtn").addEventListener("click", () => refreshList(true));
    $("search").addEventListener("input", applyFiltersAndRender);
    $("filterStatus").addEventListener("change", applyFiltersAndRender);
    $("sortBy").addEventListener("change", applyFiltersAndRender);

    // ì´ˆê¸° ì‹¤í–‰
    $("autoPill").textContent = `ğŸ”„ ìë™ ê°±ì‹ : ${Math.round(CONFIG.POLL_MS/1000)}ì´ˆ`;
    refreshList(false);
    startPolling();
  </script>
</body>
</html>
